version: 3
projects:
  - name: dev
    dir: environment/dev
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars"]
      enabled: true
    workflow: custom

workflows:
  custom:
    plan:
      steps:
        - init:
            extra_args: ["-backend-config=bucket=my-iac-states", "-backend-config=key=dev/terraform.tfstate"]
        - plan:
            extra_args:
            - -compact-warnings
    apply_requirements:
      - approved    # Requires pull request approval by a reviewer before applying changes
      - mergeable 
    apply:
      steps:
        - apply
  
  # - name: production
  #   dir: environment/production
  #   workspace: default
  #   autoplan:
  #     when_modified: ["*.tf", "*.tfvars"]
  #     enabled: true

